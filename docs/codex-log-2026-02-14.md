# Codex記録 2026-02-14

## 概要
- ToraOnsei（Android/Kotlin 音声入力IME）を初回配信。
- GitHub ReleaseでAPK配布を開始。

## 追加更新（2026-02-14 17:17 JST）
- `.\gradlew.bat clean assembleDebug` を実行してAPKを再生成。
- 配布用APK `output/toraonsei-debug.apk` を最新化。
- `README.md` に最終更新日時と最新APKパスを追記。

## 追加更新（2026-02-14 17:33 JST）
- ランチャーアイコンをトラ模様デザインへ変更（`@drawable/ic_tiger_launcher`）。
- `AndroidManifest.xml` の `icon/roundIcon` を新アイコン参照に差し替え。
- `.\gradlew.bat clean assembleDebug` を再実行し、`output/toraonsei-debug.apk` を再更新。

## 追加更新（2026-02-14 17:41 JST）
- 候補バー先頭にクリップボード表示（`貼り付け:` チップ）を追加。
- チップをタップすると、現在の入力欄へクリップボード文字列を即挿入。
- `android-debug-20260214` リリースへ `toraonsei-debug.apk` を再アップロード（`updatedAt: 2026-02-14T08:41:11Z`）。

## 追加更新（2026-02-14 17:50 JST）
- `小` キーのタップ動作を修正（濁点/半濁点を優先適用）。
- `小` キーの操作を整理（タップ=`゛/゜`、左=`゛`、右=`゜`、上下=`小文字`）。
- `android-debug-20260214` リリースへ `toraonsei-debug.apk` を再アップロード（`updatedAt: 2026-02-14T08:50:48Z`）。

## 追加更新（2026-02-14 17:57 JST）
- 予測変換/クリップボード候補バー（`+単語` 含む）を、上段からテンキー直上の領域へ移動。
- 囲み領域の空白を廃止し、候補操作をその場で完結する配置へ変更。
- `android-debug-20260214` リリースへ `toraonsei-debug.apk` を再アップロード（`updatedAt: 2026-02-14T08:57:29Z`）。

## 追加更新（2026-02-14 18:04 JST）
- 候補バー下の余白原因だった `flickGuideText` を非表示固定に変更。
- ガイド領域高さを 0 として、候補バー直下からキー行が始まるように調整。
- `android-debug-20260214` リリースへ `toraonsei-debug.apk` を再アップロード（`updatedAt: 2026-02-14T09:04:25Z`）。

## 追加更新（2026-02-14 18:16 JST）
- `変換` 実行時にオンライン整形（Gemini）を再有効化。
- 挙動: オンライン優先 → 失敗/上限到達時はローカル整形へ自動フォールバック。
- 設定画面で APIキー保存/削除、接続テスト、日次上限設定、オンライン整形ON/OFF を有効化。
- `android-debug-20260214` リリースへ `toraonsei-debug.apk` を再アップロード（`updatedAt: 2026-02-14T09:16:40Z`）。

## 追加更新（2026-02-14 20:25 JST）
- MLC(OpenAI互換)接続を追加（URL/モデル/APIキー任意/接続テスト）。
- `変換` のオンライン実行順を `MLC優先 -> Gemini -> ローカル` に変更。
- 設定画面に MLC優先スイッチを追加し、状態表示を実装。
- `.\gradlew.bat assembleDebug testDebugUnitTest` 実行後、`output/toraonsei-debug.apk` を再生成。

## 追加更新（2026-02-14 20:45 JST）
- オンライン整形（Gemini/MLC接続）関連コードを撤去。
- 設定画面をローカル専用UIへ再構成（ネット設定項目を削除）。
- `AndroidManifest.xml` から `INTERNET` 権限を削除。
- `.\gradlew.bat assembleDebug testDebugUnitTest` 実行でビルド/テスト通過を確認。

## 追加更新（2026-02-14 21:49 JST）
- 音声認識の日本語妥当性チェックを強化し、異常出力時はシステム認識へ自動フォールバックするよう修正。
- 候補バーから `録音中/待機中` などのノイズ語を除外し、候補表示数を拡張。
- `android-debug-20260214` リリースへ `toraonsei-debug.apk` を再アップロード（`updatedAt: 2026-02-14T12:49:14Z` / `sha256:0fd7aaf29491ec9b97b4b3f08779bc8f0dfae0a25cc0d12f45ade7325ea47880`）。

## 追加更新（2026-02-14 22:00 JST）
- Androidのフォルダ選択制限対策として、ASRモデル設定を「タップ=ファイル選択」に対応。
- `tokens.txt` と `.onnx` を同時選択して設定できるよう改善（フォルダ選択は長押しで継続対応）。
- ASR/LLMモデル設定の再適用を自動化（前回選択URIを保存し、次回ワンタップで再読込）。
- ローカルASRの日本語判定を強化し、非日本語モデル混入時の誤動作を抑制。
- `android-debug-20260214` リリースへ `toraonsei-debug.apk` を再アップロード（`updatedAt: 2026-02-14T13:00:37Z` / `sha256:e78ffce4e29edd9398764e8198b3441ae911be0ec01f84ea5a59d0e6e65de354`）。

## 配布リンク（固定）
- 直接ダウンロード: https://github.com/Koutacode/toraonsei-ime/releases/latest/download/toraonsei-debug.apk
- リリースページ: https://github.com/Koutacode/toraonsei-ime/releases/tag/android-debug-20260214

## リポジトリ
- https://github.com/Koutacode/toraonsei-ime
